require File.dirname(__FILE__) + '/../spec_helper'

describe 'TwitterTags' do
  dataset :pages

  describe '<r:twitter> The main context' do

    it 'should give no output' do
      tag = %{<r:twitter />}
      expected = ''

      pages(:home).should render(tag).as(expected)
    end
  end

  describe '<r:twitter:tweets> Collect the users recent tweets' do
    it 'should give no output' do
      tag = %{<r:twitter><r:tweets></r:tweets></r:twitter>}

      httpauth = mock("HTTPAuth")
      timeline = mock("timeline")
      #timeline = mock("timeline", :null_object => true) can't convert Spec::Mocks::Mock into String

      Twitter::HTTPAuth.should_receive(:new).and_return(httpauth)

      #why do I need these 2? I've not set expectations on timeline?
      timeline.should_receive(:code).and_return("1236")
      timeline.should_receive(:body).and_return("{some => json}")

      httpauth.stub!(:get).with("/statuses/user_timeline.json",nil).and_return(timeline)

      Twitter::Base.stub!(:user_timeline).and_return({:status => "status one"},{:status => "status two"},{:status => "status three"})

      expected = ''
      pages(:home).should render(tag).as(expected)
    end

    it 'should report the correct number of tweets (default 10)' do
      tag = %{<r:twitter><r:tweets:length /></r:twitter>}


      httpauth = mock("HTTPAuth")
      timeline = mock("timeline")
      #timeline = mock("timeline", :null_object => true) can't convert Spec::Mocks::Mock into String

      Twitter::HTTPAuth.should_receive(:new).and_return(httpauth)

      #why do I need these 2? I've not set expectations on timeline?
      timeline.should_receive(:code).and_return("1236")
      timeline.should_receive(:body).and_return(%q([{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","followers_count":279821,"description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"friends_count":399,"favourites_count":192,"profile_background_color":"9ae4e8","following":true,"verified":false,"notifications":false,"profile_sidebar_fill_color":"e0ff92","time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","statuses_count":5093,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":9436992,"in_reply_to_status_id":6908278677,"in_reply_to_screen_name":"abraham","id":6908315541,"text":"@abraham yes. Especially if they provide something to share in hiring meetings.","created_at":"Mon Dec 21 22:59:45 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"statuses_count":5092,"profile_background_color":"9ae4e8","following":false,"followers_count":279815,"profile_sidebar_fill_color":"e0ff92","friends_count":399,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","notifications":false,"favourites_count":192,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"verified":false,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":4949061,"in_reply_to_status_id":6907860203,"in_reply_to_screen_name":"twigsy","id":6908009195,"text":"@twigsy put me in a car, turn on You Belong With Me, and watch out!","created_at":"Mon Dec 21 22:48:25 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","verified":false,"profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":false,"profile_sidebar_fill_color":"e0ff92","followers_count":279785,"statuses_count":5091,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","friends_count":399,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"geo_enabled":false,"notifications":false,"utc_offset":-18000,"favourites_count":192,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":null,"in_reply_to_status_id":null,"in_reply_to_screen_name":null,"id":6907686094,"text":"I just got the best Christmas gift of the year. @mandymarks knows me all too well.  http://twitpic.com/uk3i6","created_at":"Mon Dec 21 22:36:22 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"verified":false,"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":true,"profile_sidebar_fill_color":"e0ff92","followers_count":279656,"statuses_count":5090,"time_zone":"Eastern Time (US & Canada)","friends_count":399,"profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","notifications":false,"favourites_count":192,"id":1401881,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":652193,"in_reply_to_status_id":null,"in_reply_to_screen_name":"parislemon","id":6905852618,"text":"@parislemon your best headline of the year. You know which one I'm talking about.","created_at":"Mon Dec 21 21:26:10 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"statuses_count":5089,"profile_background_color":"9ae4e8","following":false,"followers_count":279577,"profile_sidebar_fill_color":"e0ff92","friends_count":399,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","notifications":false,"favourites_count":192,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"verified":false,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":14049312,"in_reply_to_status_id":null,"in_reply_to_screen_name":"grhoads219","id":6904682496,"text":"@grhoads219 did you go to this? Right in your 'hood: http://bit.ly/8cbqWP","created_at":"Mon Dec 21 20:40:35 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","verified":false,"profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":true,"statuses_count":5088,"profile_sidebar_fill_color":"e0ff92","followers_count":279549,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","friends_count":399,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"geo_enabled":false,"notifications":false,"utc_offset":-18000,"favourites_count":192,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":null,"in_reply_to_status_id":null,"in_reply_to_screen_name":null,"id":6904080969,"text":"Checking out http://flocking.me. Search and trends for your friend's timeline.","created_at":"Mon Dec 21 20:17:14 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","verified":false,"profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":true,"statuses_count":5087,"profile_sidebar_fill_color":"e0ff92","followers_count":279367,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","friends_count":399,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"geo_enabled":false,"notifications":false,"utc_offset":-18000,"favourites_count":192,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":287713,"in_reply_to_status_id":6900938373,"in_reply_to_screen_name":"crystale","id":6901606138,"text":"@crystale you just changed my morning routine with the @nytimes skimmer link.","created_at":"Mon Dec 21 18:41:47 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","verified":false,"profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":null,"statuses_count":5086,"profile_sidebar_fill_color":"e0ff92","followers_count":275084,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","friends_count":399,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"geo_enabled":false,"notifications":null,"utc_offset":-18000,"favourites_count":192,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":null,"in_reply_to_status_id":null,"in_reply_to_screen_name":null,"id":6854700493,"text":"I was scared stiff! RT @mandymarks: I guess they don't ice skate much in North Carolina...great night with the boys http://twitpic.com/ub9bg","created_at":"Sun Dec 20 07:30:42 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","followers_count":275065,"description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"friends_count":399,"favourites_count":192,"profile_background_color":"9ae4e8","following":null,"verified":false,"notifications":null,"profile_sidebar_fill_color":"e0ff92","time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","statuses_count":5085,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":null,"in_reply_to_status_id":null,"in_reply_to_screen_name":null,"id":6854549720,"text":"One last holiday skate with @dnickell and @m_Marcotte at Union Square (and @mandymarks, not pictured) http://twitpic.com/ub9dd","created_at":"Sun Dec 20 07:22:13 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"statuses_count":5084,"profile_background_color":"9ae4e8","following":null,"followers_count":274902,"profile_sidebar_fill_color":"e0ff92","friends_count":399,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","notifications":null,"favourites_count":192,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"verified":false,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":null,"in_reply_to_status_id":null,"in_reply_to_screen_name":null,"id":6852637475,"text":"Fun swapping bottles of wine with @rsarver, @Devon, @tconrad and @springfever's party after a run in at dinner  http://twitpic.com/uaxe3","created_at":"Sun Dec 20 05:47:39 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"statuses_count":5083,"profile_background_color":"9ae4e8","following":null,"followers_count":274839,"profile_sidebar_fill_color":"e0ff92","friends_count":399,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","notifications":null,"favourites_count":192,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"verified":false,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":3355001,"in_reply_to_status_id":6851815198,"in_reply_to_screen_name":"Devon","id":6852053465,"text":"@Devon Happy Holidays (find me a wife)!","created_at":"Sun Dec 20 05:22:08 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":true,"followers_count":272083,"statuses_count":5082,"profile_sidebar_fill_color":"e0ff92","friends_count":399,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","notifications":false,"favourites_count":192,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"verified":false,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":null,"in_reply_to_status_id":null,"in_reply_to_screen_name":null,"id":6821949330,"text":"If a bomb blew thus place up, the Internet would stop. http://twitpic.com/u4uqq","created_at":"Sat Dec 19 06:04:18 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"statuses_count":5081,"profile_background_color":"9ae4e8","following":null,"followers_count":271325,"profile_sidebar_fill_color":"e0ff92","friends_count":399,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","notifications":null,"favourites_count":192,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"verified":false,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":27719284,"in_reply_to_status_id":6804261297,"in_reply_to_screen_name":"M_Marcotte","id":6812524702,"text":"@M_Marcotte close: Glasvegas.","created_at":"Fri Dec 18 23:46:42 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"statuses_count":5080,"profile_background_color":"9ae4e8","following":null,"followers_count":270887,"profile_sidebar_fill_color":"e0ff92","friends_count":399,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","notifications":null,"favourites_count":192,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.792911,-122.428915","name":"Doug Williams","id":1401881,"verified":false,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":23122647,"in_reply_to_status_id":6805506328,"in_reply_to_screen_name":"mandymarks","id":6805880157,"text":"@mandymarks can't wait for the video of lights! Move over @tiesto, 2040 is coming. \n\nPS: should play a Feel it In My Bones video off youtube","created_at":"Fri Dec 18 19:31:21 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","friends_count":399,"description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","verified":false,"notifications":null,"profile_background_tile":false,"favourites_count":192,"profile_background_color":"9ae4e8","following":null,"profile_sidebar_fill_color":"e0ff92","statuses_count":5079,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.792911,-122.428915","name":"Doug Williams","followers_count":270865,"id":1401881,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":null,"in_reply_to_status_id":null,"in_reply_to_screen_name":null,"id":6805526260,"text":"RT @jazzychad: interesting twitter app idea? auto-update twitter background with latest posted twitpic/yfrog/flickr image...","created_at":"Fri Dec 18 19:18:01 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","verified":false,"profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":false,"statuses_count":5078,"profile_sidebar_fill_color":"e0ff92","followers_count":270864,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","friends_count":399,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.792911,-122.428915","name":"Doug Williams","id":1401881,"geo_enabled":false,"notifications":false,"utc_offset":-18000,"favourites_count":192,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":6633812,"in_reply_to_status_id":6805135324,"in_reply_to_screen_name":"jazzychad","id":6805524651,"text":"@jazzychad do it!","created_at":"Fri Dec 18 19:17:58 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","verified":false,"profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":true,"statuses_count":5077,"profile_sidebar_fill_color":"e0ff92","followers_count":270855,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","friends_count":399,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.792911,-122.428915","name":"Doug Williams","id":1401881,"geo_enabled":false,"notifications":false,"utc_offset":-18000,"favourites_count":192,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":9161782,"in_reply_to_status_id":6803638432,"in_reply_to_screen_name":"jessmartin","id":6805273318,"text":"@jessmartin I'll be there the 24-30th. We should meet at @openeye sometime.","created_at":"Fri Dec 18 19:08:25 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","verified":false,"profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":true,"statuses_count":5076,"profile_sidebar_fill_color":"e0ff92","followers_count":270742,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","friends_count":399,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.792911,-122.428915","name":"Doug Williams","id":1401881,"geo_enabled":false,"notifications":false,"utc_offset":-18000,"favourites_count":192,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":16278286,"in_reply_to_status_id":6803333795,"in_reply_to_screen_name":"laur","id":6803448567,"text":"@laur right here. show up at my house around 11PM. Bring funglasses and classy wine. A small gathering of friends.","created_at":"Fri Dec 18 17:59:31 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":null,"followers_count":270701,"statuses_count":5075,"profile_sidebar_fill_color":"e0ff92","friends_count":399,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","notifications":null,"favourites_count":192,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.792911,-122.428915","name":"Doug Williams","id":1401881,"verified":false,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":16278286,"in_reply_to_status_id":6801782970,"in_reply_to_screen_name":"laur","id":6802762577,"text":"@laur I was planning that very run tomorrow, with the addition of sea side heights. Are you coming to my party tonight?","created_at":"Fri Dec 18 17:35:01 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"statuses_count":5074,"profile_background_color":"9ae4e8","following":true,"followers_count":270697,"profile_sidebar_fill_color":"e0ff92","friends_count":399,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","notifications":false,"favourites_count":192,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.792911,-122.428915","name":"Doug Williams","id":1401881,"verified":false,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":null,"in_reply_to_status_id":null,"in_reply_to_screen_name":null,"id":6802719821,"text":"RT @jazzychad: http://awesomeli.st/ is using @TweetHook to power their list creation!","created_at":"Fri Dec 18 17:33:33 +0000 2009"}] ))

      httpauth.stub!(:get).with("/statuses/user_timeline.json",nil).and_return(timeline)

      expected = "10"
      pages(:home).should render(tag).as(expected)
    end

    it 'should report the correct number of tweets (mex 4)' do
      tag = %{<r:twitter><r:tweets max='4'><r:length /></r:tweets></r:twitter>}


      httpauth = mock("HTTPAuth")
      timeline = mock("timeline")
      #timeline = mock("timeline", :null_object => true) can't convert Spec::Mocks::Mock into String

      Twitter::HTTPAuth.should_receive(:new).and_return(httpauth)

      #why do I need these 2? I've not set expectations on timeline?
      timeline.should_receive(:code).and_return("1236")
      timeline.should_receive(:body).and_return(%q([{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","followers_count":279821,"description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"friends_count":399,"favourites_count":192,"profile_background_color":"9ae4e8","following":true,"verified":false,"notifications":false,"profile_sidebar_fill_color":"e0ff92","time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","statuses_count":5093,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":9436992,"in_reply_to_status_id":6908278677,"in_reply_to_screen_name":"abraham","id":6908315541,"text":"@abraham yes. Especially if they provide something to share in hiring meetings.","created_at":"Mon Dec 21 22:59:45 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"statuses_count":5092,"profile_background_color":"9ae4e8","following":false,"followers_count":279815,"profile_sidebar_fill_color":"e0ff92","friends_count":399,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","notifications":false,"favourites_count":192,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"verified":false,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":4949061,"in_reply_to_status_id":6907860203,"in_reply_to_screen_name":"twigsy","id":6908009195,"text":"@twigsy put me in a car, turn on You Belong With Me, and watch out!","created_at":"Mon Dec 21 22:48:25 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","verified":false,"profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":false,"profile_sidebar_fill_color":"e0ff92","followers_count":279785,"statuses_count":5091,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","friends_count":399,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"geo_enabled":false,"notifications":false,"utc_offset":-18000,"favourites_count":192,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":null,"in_reply_to_status_id":null,"in_reply_to_screen_name":null,"id":6907686094,"text":"I just got the best Christmas gift of the year. @mandymarks knows me all too well.  http://twitpic.com/uk3i6","created_at":"Mon Dec 21 22:36:22 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"verified":false,"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":true,"profile_sidebar_fill_color":"e0ff92","followers_count":279656,"statuses_count":5090,"time_zone":"Eastern Time (US & Canada)","friends_count":399,"profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","notifications":false,"favourites_count":192,"id":1401881,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":652193,"in_reply_to_status_id":null,"in_reply_to_screen_name":"parislemon","id":6905852618,"text":"@parislemon your best headline of the year. You know which one I'm talking about.","created_at":"Mon Dec 21 21:26:10 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"statuses_count":5089,"profile_background_color":"9ae4e8","following":false,"followers_count":279577,"profile_sidebar_fill_color":"e0ff92","friends_count":399,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","notifications":false,"favourites_count":192,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"verified":false,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":14049312,"in_reply_to_status_id":null,"in_reply_to_screen_name":"grhoads219","id":6904682496,"text":"@grhoads219 did you go to this? Right in your 'hood: http://bit.ly/8cbqWP","created_at":"Mon Dec 21 20:40:35 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","verified":false,"profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":true,"statuses_count":5088,"profile_sidebar_fill_color":"e0ff92","followers_count":279549,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","friends_count":399,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"geo_enabled":false,"notifications":false,"utc_offset":-18000,"favourites_count":192,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":null,"in_reply_to_status_id":null,"in_reply_to_screen_name":null,"id":6904080969,"text":"Checking out http://flocking.me. Search and trends for your friend's timeline.","created_at":"Mon Dec 21 20:17:14 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","verified":false,"profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":true,"statuses_count":5087,"profile_sidebar_fill_color":"e0ff92","followers_count":279367,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","friends_count":399,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"geo_enabled":false,"notifications":false,"utc_offset":-18000,"favourites_count":192,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":287713,"in_reply_to_status_id":6900938373,"in_reply_to_screen_name":"crystale","id":6901606138,"text":"@crystale you just changed my morning routine with the @nytimes skimmer link.","created_at":"Mon Dec 21 18:41:47 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","verified":false,"profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":null,"statuses_count":5086,"profile_sidebar_fill_color":"e0ff92","followers_count":275084,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","friends_count":399,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"geo_enabled":false,"notifications":null,"utc_offset":-18000,"favourites_count":192,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":null,"in_reply_to_status_id":null,"in_reply_to_screen_name":null,"id":6854700493,"text":"I was scared stiff! RT @mandymarks: I guess they don't ice skate much in North Carolina...great night with the boys http://twitpic.com/ub9bg","created_at":"Sun Dec 20 07:30:42 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","followers_count":275065,"description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"friends_count":399,"favourites_count":192,"profile_background_color":"9ae4e8","following":null,"verified":false,"notifications":null,"profile_sidebar_fill_color":"e0ff92","time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","statuses_count":5085,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":null,"in_reply_to_status_id":null,"in_reply_to_screen_name":null,"id":6854549720,"text":"One last holiday skate with @dnickell and @m_Marcotte at Union Square (and @mandymarks, not pictured) http://twitpic.com/ub9dd","created_at":"Sun Dec 20 07:22:13 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"statuses_count":5084,"profile_background_color":"9ae4e8","following":null,"followers_count":274902,"profile_sidebar_fill_color":"e0ff92","friends_count":399,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","notifications":null,"favourites_count":192,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"verified":false,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":null,"in_reply_to_status_id":null,"in_reply_to_screen_name":null,"id":6852637475,"text":"Fun swapping bottles of wine with @rsarver, @Devon, @tconrad and @springfever's party after a run in at dinner  http://twitpic.com/uaxe3","created_at":"Sun Dec 20 05:47:39 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"statuses_count":5083,"profile_background_color":"9ae4e8","following":null,"followers_count":274839,"profile_sidebar_fill_color":"e0ff92","friends_count":399,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","notifications":null,"favourites_count":192,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"verified":false,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":3355001,"in_reply_to_status_id":6851815198,"in_reply_to_screen_name":"Devon","id":6852053465,"text":"@Devon Happy Holidays (find me a wife)!","created_at":"Sun Dec 20 05:22:08 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":true,"followers_count":272083,"statuses_count":5082,"profile_sidebar_fill_color":"e0ff92","friends_count":399,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","notifications":false,"favourites_count":192,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"verified":false,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":null,"in_reply_to_status_id":null,"in_reply_to_screen_name":null,"id":6821949330,"text":"If a bomb blew thus place up, the Internet would stop. http://twitpic.com/u4uqq","created_at":"Sat Dec 19 06:04:18 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"statuses_count":5081,"profile_background_color":"9ae4e8","following":null,"followers_count":271325,"profile_sidebar_fill_color":"e0ff92","friends_count":399,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","notifications":null,"favourites_count":192,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.782738,-122.401553","name":"Doug Williams","id":1401881,"verified":false,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":27719284,"in_reply_to_status_id":6804261297,"in_reply_to_screen_name":"M_Marcotte","id":6812524702,"text":"@M_Marcotte close: Glasvegas.","created_at":"Fri Dec 18 23:46:42 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"statuses_count":5080,"profile_background_color":"9ae4e8","following":null,"followers_count":270887,"profile_sidebar_fill_color":"e0ff92","friends_count":399,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","notifications":null,"favourites_count":192,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.792911,-122.428915","name":"Doug Williams","id":1401881,"verified":false,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":23122647,"in_reply_to_status_id":6805506328,"in_reply_to_screen_name":"mandymarks","id":6805880157,"text":"@mandymarks can't wait for the video of lights! Move over @tiesto, 2040 is coming. \n\nPS: should play a Feel it In My Bones video off youtube","created_at":"Fri Dec 18 19:31:21 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","friends_count":399,"description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","verified":false,"notifications":null,"profile_background_tile":false,"favourites_count":192,"profile_background_color":"9ae4e8","following":null,"profile_sidebar_fill_color":"e0ff92","statuses_count":5079,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.792911,-122.428915","name":"Doug Williams","followers_count":270865,"id":1401881,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":null,"in_reply_to_status_id":null,"in_reply_to_screen_name":null,"id":6805526260,"text":"RT @jazzychad: interesting twitter app idea? auto-update twitter background with latest posted twitpic/yfrog/flickr image...","created_at":"Fri Dec 18 19:18:01 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","verified":false,"profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":false,"statuses_count":5078,"profile_sidebar_fill_color":"e0ff92","followers_count":270864,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","friends_count":399,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.792911,-122.428915","name":"Doug Williams","id":1401881,"geo_enabled":false,"notifications":false,"utc_offset":-18000,"favourites_count":192,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":6633812,"in_reply_to_status_id":6805135324,"in_reply_to_screen_name":"jazzychad","id":6805524651,"text":"@jazzychad do it!","created_at":"Fri Dec 18 19:17:58 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","verified":false,"profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":true,"statuses_count":5077,"profile_sidebar_fill_color":"e0ff92","followers_count":270855,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","friends_count":399,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.792911,-122.428915","name":"Doug Williams","id":1401881,"geo_enabled":false,"notifications":false,"utc_offset":-18000,"favourites_count":192,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":9161782,"in_reply_to_status_id":6803638432,"in_reply_to_screen_name":"jessmartin","id":6805273318,"text":"@jessmartin I'll be there the 24-30th. We should meet at @openeye sometime.","created_at":"Fri Dec 18 19:08:25 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","verified":false,"profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":true,"statuses_count":5076,"profile_sidebar_fill_color":"e0ff92","followers_count":270742,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","friends_count":399,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.792911,-122.428915","name":"Doug Williams","id":1401881,"geo_enabled":false,"notifications":false,"utc_offset":-18000,"favourites_count":192,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":16278286,"in_reply_to_status_id":6803333795,"in_reply_to_screen_name":"laur","id":6803448567,"text":"@laur right here. show up at my house around 11PM. Bring funglasses and classy wine. A small gathering of friends.","created_at":"Fri Dec 18 17:59:31 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"profile_background_color":"9ae4e8","following":null,"followers_count":270701,"statuses_count":5075,"profile_sidebar_fill_color":"e0ff92","friends_count":399,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","notifications":null,"favourites_count":192,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.792911,-122.428915","name":"Doug Williams","id":1401881,"verified":false,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":16278286,"in_reply_to_status_id":6801782970,"in_reply_to_screen_name":"laur","id":6802762577,"text":"@laur I was planning that very run tomorrow, with the addition of sea side heights. Are you coming to my party tonight?","created_at":"Fri Dec 18 17:35:01 +0000 2009"},{"geo":null,"source":"<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>","truncated":false,"favorited":false,"user":{"profile_background_image_url":"http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg","description":"You'll find me: working at Twitter, running, or laughing at my 8 roommates.","profile_link_color":"0000ff","profile_background_tile":false,"statuses_count":5074,"profile_background_color":"9ae4e8","following":true,"followers_count":270697,"profile_sidebar_fill_color":"e0ff92","friends_count":399,"time_zone":"Eastern Time (US & Canada)","profile_sidebar_border_color":"87bc44","protected":false,"url":"http://www.igudo.com","notifications":false,"favourites_count":192,"profile_image_url":"http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg","location":"37.792911,-122.428915","name":"Doug Williams","id":1401881,"verified":false,"geo_enabled":false,"utc_offset":-18000,"created_at":"Sun Mar 18 06:42:26 +0000 2007","profile_text_color":"000000","screen_name":"dougw"},"in_reply_to_user_id":null,"in_reply_to_status_id":null,"in_reply_to_screen_name":null,"id":6802719821,"text":"RT @jazzychad: http://awesomeli.st/ is using @TweetHook to power their list creation!","created_at":"Fri Dec 18 17:33:33 +0000 2009"}] ))

      httpauth.stub!(:get).with("/statuses/user_timeline.json",nil).and_return(timeline)

      expected = "4"
      pages(:home).should render(tag).as(expected)
    end

    it 'should return the tweet text' do
      tag = %{<r:twitter><r:tweets:each><r:tweet:text /></r:tweets:each></r:twitter>}

      mock_user_timeline_with_single_tweet()

      expected = "@abraham yes. Especially if they provide something to share in hiring meetings. <a class=\"twitter_link\" href=\"http://cenatus.org\">http://cenatus.org</a>"
      pages(:home).should render(tag).as(expected)
    end

    it 'should return the created at timestamp' do
      tag = %{<r:twitter><r:tweets:each><r:tweet:created_at /></r:tweets:each></r:twitter>}

      mock_user_timeline_with_single_tweet()

      expected = "Mon Dec 21 22:59:45 +0000 2009"
      pages(:home).should render(tag).as(expected)
    end

    # TODO freeze today?
    #it 'should return the created ago string' do
    #end

    it 'should return the source' do
      tag = %{<r:twitter><r:tweets:each><r:tweet:source /></r:tweets:each></r:twitter>}

      mock_user_timeline_with_single_tweet()

      expected = "<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>"
      pages(:home).should render(tag).as(expected)
    end
  end

  
  private
  def mock_user_timeline_with_single_tweet()
    httpauth = mock("HTTPAuth")
    timeline = mock("timeline")
    #timeline = mock("timeline", :null_object => true) can't convert Spec::Mocks::Mock into String

    Twitter::HTTPAuth.should_receive(:new).and_return(httpauth)

    #why do I need these 2? I've not set expectations on timeline?
    timeline.should_receive(:code).and_return("1236")
    timeline.should_receive(:body).and_return(%q([ { "created_at" : "Mon Dec 21 22:59:45 +0000 2009",
    "favorited" : false,
    "geo" : null,
    "id" : 6908315541,
    "in_reply_to_screen_name" : "abraham",
    "in_reply_to_status_id" : 6908278677,
    "in_reply_to_user_id" : 9436992,
    "source" : "<a href=\"http://www.atebits.com/\" rel=\"nofollow\">Tweetie</a>",
    "text" : "@abraham yes. Especially if they provide something to share in hiring meetings. http://cenatus.org",
    "truncated" : false,
    "user" : { "created_at" : "Sun Mar 18 06:42:26 +0000 2007",
        "description" : "You'll find me: working at Twitter, running, or laughing at my 8 roommates.",
        "favourites_count" : 192,
        "followers_count" : 279821,
        "following" : true,
        "friends_count" : 399,
        "geo_enabled" : false,
        "id" : 1401881,
        "location" : "37.782738,-122.401553",
        "name" : "Doug Williams",
        "notifications" : false,
        "profile_background_color" : "9ae4e8",
        "profile_background_image_url" : "http://a1.twimg.com/profile_background_images/2752608/twitter_bg_grass.jpg",
        "profile_background_tile" : false,
        "profile_image_url" : "http://a1.twimg.com/profile_images/483178212/dougw_avatar_normal.jpg",
        "profile_link_color" : "0000ff",
        "profile_sidebar_border_color" : "87bc44",
        "profile_sidebar_fill_color" : "e0ff92",
        "profile_text_color" : "000000",
        "protected" : false,
        "screen_name" : "dougw",
        "statuses_count" : 5093,
        "time_zone" : "Eastern Time (US & Canada)",
        "url" : "http://www.igudo.com",
        "utc_offset" : -18000,
        "verified" : false
      }
  }
  ]))

    httpauth.stub!(:get).with("/statuses/user_timeline.json", nil).and_return(timeline)
  end
end